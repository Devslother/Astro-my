---
import styles from './Pagination.module.css';
import ArrowRight from '@/assets/learn/arrow-right.svg';
import ArrowLeft from '@/assets/learn/arrow-left.svg';
import clsx from 'clsx';

interface Props {
	currentPage: number;
	totalPages: number;
	baseUrl: string;
}

const { currentPage, totalPages, baseUrl } = Astro.props;

const getPageUrl = (page: number) => {
	const currentUrl = new URL(Astro.url);
	const queryString = currentUrl.search;

	const pagePath = page === 1 ? baseUrl : `${baseUrl}/${page}`;
	return `${pagePath}${queryString}`;
};

const getVisiblePages = (current: number, total: number) => {
	if (total <= 5) {
		return Array.from({ length: total }, (_, i) => i + 1);
	}

	if (current <= 3) {
		return [1, 2, 3, 4, null, total];
	}

	if (current >= total - 2) {
		return [1, null, total - 3, total - 2, total - 1, total];
	}

	return [1, null, current - 1, current, current + 1, null, total];
};
---

<nav data-pagination class={styles.pagination} aria-label="Pagination">
  <ul class={styles.list}>
    {
			currentPage > 1 && (
				<li class={styles.item}>
          <a
						href={getPageUrl(currentPage - 1)}
						class={clsx(styles.link, styles['link--prev'])}
						aria-label="Previous page"
						data-astro-reload
					>
            <ArrowLeft class={clsx(
							styles.arrow,
							'arrow-pag'
							)}
						/>
          </a>
        </li>
        )
		}

		{
			getVisiblePages(currentPage, totalPages).map((pageNum, index, array) => (
        <li class={styles.item}>
          {pageNum === null ? (
						<button
					    class={clsx(styles.link, styles['link--ellipsis'])}
							onclick={`window.location.href='${getPageUrl(
								index === 1 ? currentPage - 1 : currentPage + 1
							)}'`}
							aria-label="More pages"
						>
							...
						</button>
          ):(
						<a
							href={getPageUrl(pageNum)}
							class={clsx(
                styles.link,
                pageNum === currentPage && styles['link--active']
              )}
							aria-label={`Page ${pageNum}`}
							aria-current={pageNum === currentPage ? "page" : undefined}
							data-astro-reload
						>
							{pageNum}
						</a>
          )}
        </li>
      ))
    }

    {
      currentPage < totalPages && (
        <li class={styles.item}>
          <a
						href={getPageUrl(currentPage + 1)}
						class={clsx(styles.link, styles['link--next'])}
						aria-label="Next page"
						data-astro-reload
					>
            <ArrowRight 
							class={clsx(
							styles.arrow,
							'arrow-pag'
							)}
						/>
          </a>
        </li>
      )
    }
  </ul>
</nav>