---
const { fallback = "/learn" } = Astro.props;
import styles from './BackButton.module.css'
import Icon from '@/assets/left.svg'
import clsx from 'clsx';
---

<button class={clsx(
  'text__body--16-medium',
  'text__body--16-medium-lg',
  'text__body--16-medium-md',
  styles.btn
  )} data-fallback={fallback}>
  <Icon width={16} height={16} />
  Back
</button>

<script is:inline>
  document.addEventListener('DOMContentLoaded', function() {
    const backButtons = document.querySelectorAll('button[data-fallback]');
    
    backButtons.forEach(button => {
      button.addEventListener('click', function() {
        const fallback = this.getAttribute('data-fallback');
        const referrer = document.referrer;
        const current = window.location.href;
        const origin = window.location.origin;

        // Если пользователь пришел с другой страницы статьи, всегда идем в список
        if (referrer && referrer.startsWith(origin) && referrer.includes('/learn/') && referrer !== current) {
          window.location.href = fallback || '/learn';
        } else if (referrer && referrer.startsWith(origin) && referrer !== current) {
          window.location.href = referrer;
        } else {
          window.location.href = fallback || '/learn';
        }
      });
    });
  });
</script>
