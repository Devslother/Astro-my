---
import styles from './ShareButton.module.css'
import clsx from "clsx";
import IconX from '@/assets/learn/x.svg';
import IconF from '@/assets/learn/f.svg';
import IconIn from '@/assets/learn/in.svg';
import IconCopy from '@/assets/learn/copy.svg';

interface Props {
  url: string;
  title: string;
}

const { url, title } = Astro.props;
---

<div class={styles.share}>
  <span class={clsx(
    'text__body--14',
    'text__body--14-lg',
    'text__body--14-md',
    styles.label
  )}>
    Share:
  </span>
  <div class={styles.list}>
    <a
      class={styles.button}
      href={`https://twitter.com/intent/tweet?url=${encodeURIComponent(url)}&text=${encodeURIComponent(title)}`}
      target="_blank"
      rel="noopener noreferrer"
      aria-label="Share on X"
    >
      <IconX class={styles.icon} />
    </a>

    <a
      class={styles.button}
      href={`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`}
      target="_blank"
      rel="noopener noreferrer"
      aria-label="Share on Facebook"
    >
      <IconF class={styles.icon} />
    </a>

    <a
      class={styles.button}
      href={`https://www.linkedin.com/shareArticle?mini=true&url=${encodeURIComponent(url)}&title=${encodeURIComponent(title)}`}
      target="_blank"
      rel="noopener noreferrer"
      aria-label="Share on LinkedIn"
    >
      <IconIn class={styles.icon} />
    </a>

    <button class={styles.button} id="copyBtn" aria-label="Copy link" data-url={url}>
      <IconCopy class={styles.icon} />
      <span id="copiedMsg"
        class={clsx(
          'text__body--14-medium',
          'text__body--14-medium-lg',
          'text__body--14-medium-md',
          styles.tooltip
        )}>
        Copied!
      </span>
    </button>
  </div>
</div>

<script is:inline>
  (function () {
    const copyBtn = document.getElementById("copyBtn");
    const msg = document.getElementById("copiedMsg");

    if (copyBtn && msg) {
      copyBtn.addEventListener("click", () => {
        const urlToCopy = copyBtn.getAttribute('data-url') || window.location.href;
        navigator.clipboard
          .writeText(urlToCopy)
          .then(() => {
            // Показываю сообщение с !important
            msg.style.setProperty("opacity", "1", "important");
            msg.style.setProperty("visibility", "visible", "important");
            
            setTimeout(() => {
              // Скрываю сообщение с !important
              msg.style.setProperty("opacity", "0", "important");
              msg.style.setProperty("visibility", "hidden", "important");
            }, 2000);
          })
          .catch((err) => {
            console.error("Failed to copy: ", err);
          });
      });
    }
  })();
</script>