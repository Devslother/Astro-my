---

import Icon from '../icon/Icon.astro';
import styles from './SearchInput.module.css'
import clsx from 'clsx';

interface Props {
	placeholder?: string;
	containerClass?: string;
	id?: string;
	baseUrl?: string;
}

const {
	placeholder = "Searchâ€¦",
	containerClass = "",
	id = "search-dynamic",
	baseUrl = "/resources/search/1"
} = Astro.props;

const initial = "";
---

<label 
  class={clsx(styles.container, containerClass)} 
  for={id} 
  data-baseurl={baseUrl}
  data-search
>
  <div class={styles["icon-wrapper"]}>
    <Icon 
      name="search" 
      width={16} height={16} 
      color="var(--color-gray-700)"
      data-search-icon
      class={clsx(
        'icon--search',
        styles["search-icon"]
      )}
    />
    <Icon
      name="arrowClockwise"
      width={16} height={16} 
      color="var(--color-black)"
      data-spinner
      class={clsx(
        "icon--search",
        styles.spinner
      )}
    />
  </div>
  
  <input
		id={id}
		name="q"
		type="search"
		placeholder={placeholder}
		value={initial}
		autocomplete="off"
     class={clsx(
          'text__body--14',
          'text__body--14--lg',
          'text__body--14--md',
          styles.input,
        )}
	/>
   <Icon 
    name="close" 
    width={16} height={16} 
    color="var(--color-gray-700)"
    data-clear-btn
    class={clsx(
      "icon--search",
      styles['clear-btn']
    )}
  />
</label>

<script is:inline>
  document.addEventListener('DOMContentLoaded', function() {
    const clearBtn = document.querySelector('[data-clear-btn]');
    const input = clearBtn?.closest('[data-search]')?.querySelector('input[type="search"]');
    
    if (input && clearBtn) {
      input.addEventListener('input', function() {
        clearBtn.style.display = this.value ? 'block' : 'none';
      });
      
      clearBtn.addEventListener('click', function() {
        input.value = '';
        clearBtn.style.display = 'none';
        window.location.href = '/resources';
      });
    }
  });
</script>

